/**
 * @file main.c
 * @brief Main function core
 *
 *      This file contains the main function that initializes, configurates
 * 			and start all applications with their services. 
 *
 *			Last modification : 30 Nov 2013 
 *
 * @author Martin
 * @version 0.1.1
 * @date 08 Nov 2013
 */


/******************************************************************************
* 
*   INCLUDED FILES
*
******************************************************************************/

#include "stm32f10x.h"
#include "Clock.h"
#include "Timer_Systick.h"
#include "stdio.h"
#include "s_serialComm.h"
#include "s_filterFIR.h"
#include "global.h"

// test test
#include "FIR_Filter.h"
//#include "FIR_0.c"


/******************************************************************************
*
*   GLOBAL VARIABLES
*
******************************************************************************/

/** application state */
State_APP state = APP_OFF;
State_APP prev_state = APP_OFF;


/******************************************************************************
*
*   PRIVATE FUNCTIONS
*
******************************************************************************/

/**
 *******************************************************************************
 * app_updateDrone
 *
 *      Update Drone with special character
 *			Send special character that depends on the app state
 * 			
 * @param void
 * @return 0 if no error
 * @return 1 if error takes place in send char			
 * @sa main()
 ******************************************************************************/
 
char app_updateDrone(void)		
{
	char code_erreur = 0;
	
	switch (state)
	{
		case APP_OFF:
			code_erreur = s_serialComm_sendChar(MSG_OFF);
			break;
		case APP_RECEIVE:
			code_erreur = s_serialComm_sendChar(MSG_BUSY);
			break;
		default:
			code_erreur = 1; 		
	}
	
	return code_erreur;
}


/*
 *******************************************************************************
 * app_serialCommHandler
 *
 *      Called when serial comm interruption takes place
 *			Analyze received character and update app state
 * 			If character is not valid (protocol not respected)
 *			then the application state rest the same as before
 *
 * @sa main()
 ******************************************************************************/
 
void app_serialCommHandler(char c)		
{
	char error = 0;
	
	if (c == MSG_OFF)
	{
		if (state != APP_OFF)
		{
			prev_state = state;
			state = APP_OFF;
			// TODO stop all timers
		}
		error = app_updateDrone();
	}
	else if (c == MSG_SEND)
	{
		if (state == APP_OFF)
		{
			prev_state = state;
			state = APP_RECEIVE;
			// TODO if state = APP_RECEIVE
			// use Systick for timeout options
		}
		else
		{
			error = app_updateDrone();
		}
	}
	else
	{
		error = app_updateDrone();
	}
	
	if (error != 0)
	{
		// update Status LED
		s_serialComm_setErrorLED(LED_ON);
	}
}


/** TODO TODO TODO (collect toa from service)
 *******************************************************************************
 * app_responseDrone
 *
 *      Called when results are ready to be send to the Drone
 *			Send Data
 *			Update App State 
 *			ATTENTION : Use Systick for timeout robustness (interruption system)
 * 			
 * @sa main()
 ******************************************************************************/
 
void app_responseDrone(void)		
{
	prev_state = state;
	
	// Send data to drone
	
	
	// Update App state
	//state = APP_RECEIVE;
	
}

/**
 *******************************************************************************
 * app_send_droneData
 *
 *      Function called when STM needs to send data to drone
 *			Test input data parameters and convert into string
 *			Call function in the service comm in order to send the data
 * 			
 ******************************************************************************/

void app_send_droneData(int toa1, int toa2, int toa3, int toa4)
{
	char string[SIZE_FRAME];
	int i = 0;
	State_Input_Comm etat_input = 1;
	char code_Error = 0;
	
	// Init string
	string[0] = MSG_SEND;
	for(i=1;i<SIZE_FRAME; i++)
	{
		string[i] = MSG_NULL;
	}
	
	// Convert input data in string
	for (i=1;i<SIZE_FRAME;i++)
	{
		switch (etat_input)
		{
			case TOA1 :
				string[i] = (char) (toa1 >> (8*(i-1)));
			  break;
			case TOA2 :
				string[i] = (char) (toa2 >> (8*(i-5)));
			  break;
			case TOA3 :
				string[i] = (char) (toa3 >> (8*(i-9)));
			  break;
			case TOA4 :
				string[i] = (char) (toa4 >> (8*(i-13)));
			  break;
			
			default:
				s_serialComm_setErrorLED(LED_ON);
		}
		
		if (!(i % 4))
		{
			etat_input++;		
		}
	}
	
	// Send string to drone
	code_Error = s_serialComm_sendString(string);
	if (code_Error != 0)
	{
		// update Status LED
		s_serialComm_setErrorLED(LED_ON);
	}
}



/**
 *******************************************************************************
 * app_initialization
 *
 *      Configures all clocks and registers.
 *			Initializes all Services
 * 			Configures Systick Timer
 *
 * @sa main()
 ******************************************************************************/

void app_initialization(void)
{	
	//vu16 duree;
	char code_Erreur = 0;
	
	// Clock's configuration
	CLOCK_Configure();		// System clock initialization
												// If STM32F107 defined as target, CPU clock = 50MHz
												// Défaut (STM32F103), CPU clock = 40MHz
	
	// service initialization
	code_Erreur = s_serialComm_initialization(app_serialCommHandler);
	if (code_Erreur != 0)
	{
		s_serialComm_setErrorLED(LED_ON);
	}
/*	
	code_Erreur = s_filterFIR_initialization();
	if (code_Erreur != 0)
	{
		s_serialComm_setErrorLED(LED_ON);
	}
*/
}


/******************************************************************************
*
*   MAIN
*
******************************************************************************/
//h_1
const s32 test_signal1[256]= {
K_8_24*9.285061e-01,
K_8_24*-6.895405e-01,
K_8_24*-4.164296e-01,
K_8_24*9.987955e-01,
K_8_24*-3.253103e-01,
K_8_24*-7.572088e-01,
K_8_24*8.876396e-01,
K_8_24*9.801714e-02,
K_8_24*-9.604305e-01,
K_8_24*6.152316e-01,
K_8_24*5.035384e-01,
K_8_24*-9.891765e-01,
K_8_24*2.310581e-01,
K_8_24*8.175848e-01,
K_8_24*-8.382247e-01,
K_8_24*-1.950903e-01,
K_8_24*9.831055e-01,
K_8_24*-5.349976e-01,
K_8_24*-5.857979e-01,
K_8_24*9.700313e-01,
K_8_24*-1.345807e-01,
K_8_24*-8.700870e-01,
K_8_24*7.807372e-01,
K_8_24*2.902847e-01,
K_8_24*-9.963126e-01,
K_8_24*4.496113e-01,
K_8_24*6.624158e-01,
K_8_24*-9.415441e-01,
K_8_24*3.680722e-02,
K_8_24*9.142098e-01,
K_8_24*-7.157308e-01,
K_8_24*-3.826834e-01,
K_8_24*9.999247e-01,
K_8_24*-3.598950e-01,
K_8_24*-7.326543e-01,
K_8_24*9.039893e-01,
K_8_24*6.132074e-02,
K_8_24*-9.495282e-01,
K_8_24*6.438315e-01,
K_8_24*4.713967e-01,
K_8_24*-9.939070e-01,
K_8_24*2.667128e-01,
K_8_24*7.958369e-01,
K_8_24*-8.577286e-01,
K_8_24*-1.588581e-01,
K_8_24*9.757021e-01,
K_8_24*-5.657318e-01,
K_8_24*-5.555702e-01,
K_8_24*9.783174e-01,
K_8_24*-1.709619e-01,
K_8_24*-8.513552e-01,
K_8_24*8.032075e-01,
K_8_24*2.548657e-01,
K_8_24*-9.924795e-01,
K_8_24*4.821838e-01,
K_8_24*6.343933e-01,
K_8_24*-9.533060e-01,
K_8_24*7.356456e-02,
K_8_24*8.986745e-01,
K_8_24*-7.409511e-01,
K_8_24*-3.484187e-01,
K_8_24*9.996988e-01,
K_8_24*-3.939920e-01,
K_8_24*-7.071068e-01,
K_8_24*9.191139e-01,
K_8_24*2.454123e-02,
K_8_24*-9.373390e-01,
K_8_24*6.715590e-01,
K_8_24*4.386162e-01,
K_8_24*-9.972905e-01,
K_8_24*3.020059e-01,
K_8_24*7.730105e-01,
K_8_24*-8.760701e-01,
K_8_24*-1.224107e-01,
K_8_24*9.669765e-01,
K_8_24*-5.956993e-01,
K_8_24*-5.245897e-01,
K_8_24*9.852776e-01,
K_8_24*-2.071114e-01,
K_8_24*-8.314696e-01,
K_8_24*8.245893e-01,
K_8_24*2.191012e-01,
K_8_24*-9.873014e-01,
K_8_24*5.141027e-01,
K_8_24*6.055110e-01,
K_8_24*-9.637761e-01,
K_8_24*1.102222e-01,
K_8_24*8.819213e-01,
K_8_24*-7.651673e-01,
K_8_24*-3.136817e-01,
K_8_24*9.981181e-01,
K_8_24*-4.275551e-01,
K_8_24*-6.806010e-01,
K_8_24*9.329928e-01,
K_8_24*-1.227154e-02,
K_8_24*-9.238795e-01,
K_8_24*6.983762e-01,
K_8_24*4.052413e-01,
K_8_24*-9.993224e-01,
K_8_24*3.368899e-01,
K_8_24*7.491364e-01,
K_8_24*-8.932243e-01,
K_8_24*-8.579731e-02,
K_8_24*9.569403e-01,
K_8_24*-6.248595e-01,
K_8_24*-4.928982e-01,
K_8_24*9.909026e-01,
K_8_24*-2.429802e-01,
K_8_24*-8.104572e-01,
K_8_24*8.448536e-01,
K_8_24*1.830399e-01,
K_8_24*-9.807853e-01,
K_8_24*5.453250e-01,
K_8_24*5.758082e-01,
K_8_24*-9.729400e-01,
K_8_24*1.467305e-01,
K_8_24*8.639729e-01,
K_8_24*-7.883464e-01,
K_8_24*-2.785197e-01,
K_8_24*9.951847e-01,
K_8_24*-4.605387e-01,
K_8_24*-6.531728e-01,
K_8_24*9.456073e-01,
K_8_24*-4.906767e-02,
K_8_24*-9.091680e-01,
K_8_24*7.242471e-01,
K_8_24*3.713172e-01,
K_8_24*-1,
K_8_24*3.713172e-01,
K_8_24*7.242471e-01,
K_8_24*-9.091680e-01,
K_8_24*-4.906767e-02,
K_8_24*9.456073e-01,
K_8_24*-6.531728e-01,
K_8_24*-4.605387e-01,
K_8_24*9.951847e-01,
K_8_24*-2.785197e-01,
K_8_24*-7.883464e-01,
K_8_24*8.639729e-01,
K_8_24*1.467305e-01,
K_8_24*-9.729400e-01,
K_8_24*5.758082e-01,
K_8_24*5.453250e-01,
K_8_24*-9.807853e-01,
K_8_24*1.830399e-01,
K_8_24*8.448536e-01,
K_8_24*-8.104572e-01,
K_8_24*-2.429802e-01,
K_8_24*9.909026e-01,
K_8_24*-4.928982e-01,
K_8_24*-6.248595e-01,
K_8_24*9.569403e-01,
K_8_24*-8.579731e-02,
K_8_24*-8.932243e-01,
K_8_24*7.491364e-01,
K_8_24*3.368899e-01,
K_8_24*-9.993224e-01,
K_8_24*4.052413e-01,
K_8_24*6.983762e-01,
K_8_24*-9.238795e-01,
K_8_24*-1.227154e-02,
K_8_24*9.329928e-01,
K_8_24*-6.806010e-01,
K_8_24*-4.275551e-01,
K_8_24*9.981181e-01,
K_8_24*-3.136817e-01,
K_8_24*-7.651673e-01,
K_8_24*8.819213e-01,
K_8_24*1.102222e-01,
K_8_24*-9.637761e-01,
K_8_24*6.055110e-01,
K_8_24*5.141027e-01,
K_8_24*-9.873014e-01,
K_8_24*2.191012e-01,
K_8_24*8.245893e-01,
K_8_24*-8.314696e-01,
K_8_24*-2.071114e-01,
K_8_24*9.852776e-01,
K_8_24*-5.245897e-01,
K_8_24*-5.956993e-01,
K_8_24*9.669765e-01,
K_8_24*-1.224107e-01,
K_8_24*-8.760701e-01,
K_8_24*7.730105e-01,
K_8_24*3.020059e-01,
K_8_24*-9.972905e-01,
K_8_24*4.386162e-01,
K_8_24*6.715590e-01,
K_8_24*-9.373390e-01,
K_8_24*2.454123e-02,
K_8_24*9.191139e-01,
K_8_24*-7.071068e-01,
K_8_24*-3.939920e-01,
K_8_24*9.996988e-01,
K_8_24*-3.484187e-01,
K_8_24*-7.409511e-01,
K_8_24*8.986745e-01,
K_8_24*7.356456e-02,
K_8_24*-9.533060e-01,
K_8_24*6.343933e-01,
K_8_24*4.821838e-01,
K_8_24*-9.924795e-01,
K_8_24*2.548657e-01,
K_8_24*8.032075e-01,
K_8_24*-8.513552e-01,
K_8_24*-1.709619e-01,
K_8_24*9.783174e-01,
K_8_24*-5.555702e-01,
K_8_24*-5.657318e-01,
K_8_24*9.757021e-01,
K_8_24*-1.588581e-01,
K_8_24*-8.577286e-01,
K_8_24*7.958369e-01,
K_8_24*2.667128e-01,
K_8_24*-9.939070e-01,
K_8_24*4.713967e-01,
K_8_24*6.438315e-01,
K_8_24*-9.495282e-01,
K_8_24*6.132074e-02,
K_8_24*9.039893e-01,
K_8_24*-7.326543e-01,
K_8_24*-3.598950e-01,
K_8_24*9.999247e-01,
K_8_24*-3.826834e-01,
K_8_24*-7.157308e-01,
K_8_24*9.142098e-01,
K_8_24*3.680722e-02,
K_8_24*-9.415441e-01,
K_8_24*6.624158e-01,
K_8_24*4.496113e-01,
K_8_24*-9.963126e-01,
K_8_24*2.902847e-01,
K_8_24*7.807372e-01,
K_8_24*-8.700870e-01,
K_8_24*-1.345807e-01,
K_8_24*9.700313e-01,
K_8_24*-5.857979e-01,
K_8_24*-5.349976e-01,
K_8_24*9.831055e-01,
K_8_24*-1.950903e-01,
K_8_24*-8.382247e-01,
K_8_24*8.175848e-01,
K_8_24*2.310581e-01,
K_8_24*-9.891765e-01,
K_8_24*5.035384e-01,
K_8_24*6.152316e-01,
K_8_24*-9.604305e-01,
K_8_24*9.801714e-02,
K_8_24*8.876396e-01,
K_8_24*-7.572088e-01,
K_8_24*-3.253103e-01,
K_8_24*9.987955e-01,
K_8_24*-4.164296e-01,
K_8_24*-6.895405e-01,
K_8_24*9.285061e-01,
K_8_24*8.813743e-15,
};

// h_0
const s32 test_filter_coeff[256]= {
K_8_24*9.373390e-01,
K_8_24*-6.531728e-01,
K_8_24*-4.821838e-01,
K_8_24*9.891765e-01,
K_8_24*-2.071114e-01,
K_8_24*-8.448536e-01,
K_8_24*7.958369e-01,
K_8_24*2.902847e-01,
K_8_24*-9.981181e-01,
K_8_24*4.052413e-01,
K_8_24*7.157308e-01,
K_8_24*-9.039893e-01,
K_8_24*-8.579731e-02,
K_8_24*9.637761e-01,
K_8_24*-5.857979e-01,
K_8_24*-5.555702e-01,
K_8_24*9.729400e-01,
K_8_24*-1.224107e-01,
K_8_24*-8.876396e-01,
K_8_24*7.409511e-01,
K_8_24*3.713172e-01,
K_8_24*-9.996988e-01,
K_8_24*3.253103e-01,
K_8_24*7.730105e-01,
K_8_24*-8.639729e-01,
K_8_24*-1.709619e-01,
K_8_24*9.831055e-01,
K_8_24*-5.141027e-01,
K_8_24*-6.248595e-01,
K_8_24*9.495282e-01,
K_8_24*-3.680722e-02,
K_8_24*-9.238795e-01,
K_8_24*6.806010e-01,
K_8_24*4.496113e-01,
K_8_24*-9.939070e-01,
K_8_24*2.429802e-01,
K_8_24*8.245893e-01,
K_8_24*-8.175848e-01,
K_8_24*-2.548657e-01,
K_8_24*9.951847e-01,
K_8_24*-4.386162e-01,
K_8_24*-6.895405e-01,
K_8_24*9.191139e-01,
K_8_24*4.906767e-02,
K_8_24*-9.533060e-01,
K_8_24*6.152316e-01,
K_8_24*5.245897e-01,
K_8_24*-9.807853e-01,
K_8_24*1.588581e-01,
K_8_24*8.700870e-01,
K_8_24*-7.651673e-01,
K_8_24*-3.368899e-01,
K_8_24*9.999247e-01,
K_8_24*-3.598950e-01,
K_8_24*-7.491364e-01,
K_8_24*8.819213e-01,
K_8_24*1.345807e-01,
K_8_24*-9.757021e-01,
K_8_24*5.453250e-01,
K_8_24*5.956993e-01,
K_8_24*-9.604305e-01,
K_8_24*7.356456e-02,
K_8_24*9.091680e-01,
K_8_24*-7.071068e-01,
K_8_24*-4.164296e-01,
K_8_24*9.972905e-01,
K_8_24*-2.785197e-01,
K_8_24*-8.032075e-01,
K_8_24*8.382247e-01,
K_8_24*2.191012e-01,
K_8_24*-9.909026e-01,
K_8_24*4.713967e-01,
K_8_24*6.624158e-01,
K_8_24*-9.329928e-01,
K_8_24*-1.227154e-02,
K_8_24*9.415441e-01,
K_8_24*-6.438315e-01,
K_8_24*-4.928982e-01,
K_8_24*9.873014e-01,
K_8_24*-1.950903e-01,
K_8_24*-8.513552e-01,
K_8_24*7.883464e-01,
K_8_24*3.020059e-01,
K_8_24*-9.987955e-01,
K_8_24*3.939920e-01,
K_8_24*7.242471e-01,
K_8_24*-8.986745e-01,
K_8_24*-9.801714e-02,
K_8_24*9.669765e-01,
K_8_24*-5.758082e-01,
K_8_24*-5.657318e-01,
K_8_24*9.700313e-01,
K_8_24*-1.102222e-01,
K_8_24*-8.932243e-01,
K_8_24*7.326543e-01,
K_8_24*3.826834e-01,
K_8_24*-9.993224e-01,
K_8_24*3.136817e-01,
K_8_24*7.807372e-01,
K_8_24*-8.577286e-01,
K_8_24*-1.830399e-01,
K_8_24*9.852776e-01,
K_8_24*-5.035384e-01,
K_8_24*-6.343933e-01,
K_8_24*9.456073e-01,
K_8_24*-2.454123e-02,
K_8_24*-9.285061e-01,
K_8_24*6.715590e-01,
K_8_24*4.605387e-01,
K_8_24*-9.924795e-01,
K_8_24*2.310581e-01,
K_8_24*8.314696e-01,
K_8_24*-8.104572e-01,
K_8_24*-2.667128e-01,
K_8_24*9.963126e-01,
K_8_24*-4.275551e-01,
K_8_24*-6.983762e-01,
K_8_24*9.142098e-01,
K_8_24*6.132074e-02,
K_8_24*-9.569403e-01,
K_8_24*6.055110e-01,
K_8_24*5.349976e-01,
K_8_24*-9.783174e-01,
K_8_24*1.467305e-01,
K_8_24*8.760701e-01,
K_8_24*-7.572088e-01,
K_8_24*-3.484187e-01,
K_8_24*1,
K_8_24*-3.484187e-01,
K_8_24*-7.572088e-01,
K_8_24*8.760701e-01,
K_8_24*1.467305e-01,
K_8_24*-9.783174e-01,
K_8_24*5.349976e-01,
K_8_24*6.055110e-01,
K_8_24*-9.569403e-01,
K_8_24*6.132074e-02,
K_8_24*9.142098e-01,
K_8_24*-6.983762e-01,
K_8_24*-4.275551e-01,
K_8_24*9.963126e-01,
K_8_24*-2.667128e-01,
K_8_24*-8.104572e-01,
K_8_24*8.314696e-01,
K_8_24*2.310581e-01,
K_8_24*-9.924795e-01,
K_8_24*4.605387e-01,
K_8_24*6.715590e-01,
K_8_24*-9.285061e-01,
K_8_24*-2.454123e-02,
K_8_24*9.456073e-01,
K_8_24*-6.343933e-01,
K_8_24*-5.035384e-01,
K_8_24*9.852776e-01,
K_8_24*-1.830399e-01,
K_8_24*-8.577286e-01,
K_8_24*7.807372e-01,
K_8_24*3.136817e-01,
K_8_24*-9.993224e-01,
K_8_24*3.826834e-01,
K_8_24*7.326543e-01,
K_8_24*-8.932243e-01,
K_8_24*-1.102222e-01,
K_8_24*9.700313e-01,
K_8_24*-5.657318e-01,
K_8_24*-5.758082e-01,
K_8_24*9.669765e-01,
K_8_24*-9.801714e-02,
K_8_24*-8.986745e-01,
K_8_24*7.242471e-01,
K_8_24*3.939920e-01,
K_8_24*-9.987955e-01,
K_8_24*3.020059e-01,
K_8_24*7.883464e-01,
K_8_24*-8.513552e-01,
K_8_24*-1.950903e-01,
K_8_24*9.873014e-01,
K_8_24*-4.928982e-01,
K_8_24*-6.438315e-01,
K_8_24*9.415441e-01,
K_8_24*-1.227154e-02,
K_8_24*-9.329928e-01,
K_8_24*6.624158e-01,
K_8_24*4.713967e-01,
K_8_24*-9.909026e-01,
K_8_24*2.191012e-01,
K_8_24*8.382247e-01,
K_8_24*-8.032075e-01,
K_8_24*-2.785197e-01,
K_8_24*9.972905e-01,
K_8_24*-4.164296e-01,
K_8_24*-7.071068e-01,
K_8_24*9.091680e-01,
K_8_24*7.356456e-02,
K_8_24*-9.604305e-01,
K_8_24*5.956993e-01,
K_8_24*5.453250e-01,
K_8_24*-9.757021e-01,
K_8_24*1.345807e-01,
K_8_24*8.819213e-01,
K_8_24*-7.491364e-01,
K_8_24*-3.598950e-01,
K_8_24*9.999247e-01,
K_8_24*-3.368899e-01,
K_8_24*-7.651673e-01,
K_8_24*8.700870e-01,
K_8_24*1.588581e-01,
K_8_24*-9.807853e-01,
K_8_24*5.245897e-01,
K_8_24*6.152316e-01,
K_8_24*-9.533060e-01,
K_8_24*4.906767e-02,
K_8_24*9.191139e-01,
K_8_24*-6.895405e-01,
K_8_24*-4.386162e-01,
K_8_24*9.951847e-01,
K_8_24*-2.548657e-01,
K_8_24*-8.175848e-01,
K_8_24*8.245893e-01,
K_8_24*2.429802e-01,
K_8_24*-9.939070e-01,
K_8_24*4.496113e-01,
K_8_24*6.806010e-01,
K_8_24*-9.238795e-01,
K_8_24*-3.680722e-02,
K_8_24*9.495282e-01,
K_8_24*-6.248595e-01,
K_8_24*-5.141027e-01,
K_8_24*9.831055e-01,
K_8_24*-1.709619e-01,
K_8_24*-8.639729e-01,
K_8_24*7.730105e-01,
K_8_24*3.253103e-01,
K_8_24*-9.996988e-01,
K_8_24*3.713172e-01,
K_8_24*7.409511e-01,
K_8_24*-8.876396e-01,
K_8_24*-1.224107e-01,
K_8_24*9.729400e-01,
K_8_24*-5.555702e-01,
K_8_24*-5.857979e-01,
K_8_24*9.637761e-01,
K_8_24*-8.579731e-02,
K_8_24*-9.039893e-01,
K_8_24*7.157308e-01,
K_8_24*4.052413e-01,
K_8_24*-9.981181e-01,
K_8_24*2.902847e-01,
K_8_24*7.958369e-01,
K_8_24*-8.448536e-01,
K_8_24*-2.071114e-01,
K_8_24*9.891765e-01,
K_8_24*-4.821838e-01,
K_8_24*-6.531728e-01,
K_8_24*9.373390e-01,
K_8_24*-1.274747e-14,
};



// h_2
const s32 test_signal2[256]= {
K_8_24*9.191139e-01,
K_8_24*-7.242471e-01,
K_8_24*-3.484187e-01,
K_8_24*9.987955e-01,
K_8_24*-4.386162e-01,
K_8_24*-6.531728e-01,
K_8_24*9.533060e-01,
K_8_24*-9.801714e-02,
K_8_24*-8.760701e-01,
K_8_24*7.883464e-01,
K_8_24*2.548657e-01,
K_8_24*-9.891765e-01,
K_8_24*5.245897e-01,
K_8_24*5.758082e-01,
K_8_24*-9.783174e-01,
K_8_24*1.950903e-01,
K_8_24*8.245893e-01,
K_8_24*-8.448536e-01,
K_8_24*-1.588581e-01,
K_8_24*9.700313e-01,
K_8_24*-6.055110e-01,
K_8_24*-4.928982e-01,
K_8_24*9.939070e-01,
K_8_24*-2.902847e-01,
K_8_24*-7.651673e-01,
K_8_24*8.932243e-01,
K_8_24*6.132074e-02,
K_8_24*-9.415441e-01,
K_8_24*6.806010e-01,
K_8_24*4.052413e-01,
K_8_24*-9.999247e-01,
K_8_24*3.826834e-01,
K_8_24*6.983762e-01,
K_8_24*-9.329928e-01,
K_8_24*3.680722e-02,
K_8_24*9.039893e-01,
K_8_24*-7.491364e-01,
K_8_24*-3.136817e-01,
K_8_24*9.963126e-01,
K_8_24*-4.713967e-01,
K_8_24*-6.248595e-01,
K_8_24*9.637761e-01,
K_8_24*-1.345807e-01,
K_8_24*-8.577286e-01,
K_8_24*8.104572e-01,
K_8_24*2.191012e-01,
K_8_24*-9.831055e-01,
K_8_24*5.555702e-01,
K_8_24*5.453250e-01,
K_8_24*-9.852776e-01,
K_8_24*2.310581e-01,
K_8_24*8.032075e-01,
K_8_24*-8.639729e-01,
K_8_24*-1.224107e-01,
K_8_24*9.604305e-01,
K_8_24*-6.343933e-01,
K_8_24*-4.605387e-01,
K_8_24*9.972905e-01,
K_8_24*-3.253103e-01,
K_8_24*-7.409511e-01,
K_8_24*9.091680e-01,
K_8_24*2.454123e-02,
K_8_24*-9.285061e-01,
K_8_24*7.071068e-01,
K_8_24*3.713172e-01,
K_8_24*-9.996988e-01,
K_8_24*4.164296e-01,
K_8_24*6.715590e-01,
K_8_24*-9.456073e-01,
K_8_24*7.356456e-02,
K_8_24*8.876396e-01,
K_8_24*-7.730105e-01,
K_8_24*-2.785197e-01,
K_8_24*9.924795e-01,
K_8_24*-5.035384e-01,
K_8_24*-5.956993e-01,
K_8_24*9.729400e-01,
K_8_24*-1.709619e-01,
K_8_24*-8.382247e-01,
K_8_24*8.314696e-01,
K_8_24*1.830399e-01,
K_8_24*-9.757021e-01,
K_8_24*5.857979e-01,
K_8_24*5.141027e-01,
K_8_24*-9.909026e-01,
K_8_24*2.667128e-01,
K_8_24*7.807372e-01,
K_8_24*-8.819213e-01,
K_8_24*-8.579731e-02,
K_8_24*9.495282e-01,
K_8_24*-6.624158e-01,
K_8_24*-4.275551e-01,
K_8_24*9.993224e-01,
K_8_24*-3.598950e-01,
K_8_24*-7.157308e-01,
K_8_24*9.238795e-01,
K_8_24*-1.227154e-02,
K_8_24*-9.142098e-01,
K_8_24*7.326543e-01,
K_8_24*3.368899e-01,
K_8_24*-9.981181e-01,
K_8_24*4.496113e-01,
K_8_24*6.438315e-01,
K_8_24*-9.569403e-01,
K_8_24*1.102222e-01,
K_8_24*8.700870e-01,
K_8_24*-7.958369e-01,
K_8_24*-2.429802e-01,
K_8_24*9.873014e-01,
K_8_24*-5.349976e-01,
K_8_24*-5.657318e-01,
K_8_24*9.807853e-01,
K_8_24*-2.071114e-01,
K_8_24*-8.175848e-01,
K_8_24*8.513552e-01,
K_8_24*1.467305e-01,
K_8_24*-9.669765e-01,
K_8_24*6.152316e-01,
K_8_24*4.821838e-01,
K_8_24*-9.951847e-01,
K_8_24*3.020059e-01,
K_8_24*7.572088e-01,
K_8_24*-8.986745e-01,
K_8_24*-4.906767e-02,
K_8_24*9.373390e-01,
K_8_24*-6.895405e-01,
K_8_24*-3.939920e-01,
K_8_24*1,
K_8_24*-3.939920e-01,
K_8_24*-6.895405e-01,
K_8_24*9.373390e-01,
K_8_24*-4.906767e-02,
K_8_24*-8.986745e-01,
K_8_24*7.572088e-01,
K_8_24*3.020059e-01,
K_8_24*-9.951847e-01,
K_8_24*4.821838e-01,
K_8_24*6.152316e-01,
K_8_24*-9.669765e-01,
K_8_24*1.467305e-01,
K_8_24*8.513552e-01,
K_8_24*-8.175848e-01,
K_8_24*-2.071114e-01,
K_8_24*9.807853e-01,
K_8_24*-5.657318e-01,
K_8_24*-5.349976e-01,
K_8_24*9.873014e-01,
K_8_24*-2.429802e-01,
K_8_24*-7.958369e-01,
K_8_24*8.700870e-01,
K_8_24*1.102222e-01,
K_8_24*-9.569403e-01,
K_8_24*6.438315e-01,
K_8_24*4.496113e-01,
K_8_24*-9.981181e-01,
K_8_24*3.368899e-01,
K_8_24*7.326543e-01,
K_8_24*-9.142098e-01,
K_8_24*-1.227154e-02,
K_8_24*9.238795e-01,
K_8_24*-7.157308e-01,
K_8_24*-3.598950e-01,
K_8_24*9.993224e-01,
K_8_24*-4.275551e-01,
K_8_24*-6.624158e-01,
K_8_24*9.495282e-01,
K_8_24*-8.579731e-02,
K_8_24*-8.819213e-01,
K_8_24*7.807372e-01,
K_8_24*2.667128e-01,
K_8_24*-9.909026e-01,
K_8_24*5.141027e-01,
K_8_24*5.857979e-01,
K_8_24*-9.757021e-01,
K_8_24*1.830399e-01,
K_8_24*8.314696e-01,
K_8_24*-8.382247e-01,
K_8_24*-1.709619e-01,
K_8_24*9.729400e-01,
K_8_24*-5.956993e-01,
K_8_24*-5.035384e-01,
K_8_24*9.924795e-01,
K_8_24*-2.785197e-01,
K_8_24*-7.730105e-01,
K_8_24*8.876396e-01,
K_8_24*7.356456e-02,
K_8_24*-9.456073e-01,
K_8_24*6.715590e-01,
K_8_24*4.164296e-01,
K_8_24*-9.996988e-01,
K_8_24*3.713172e-01,
K_8_24*7.071068e-01,
K_8_24*-9.285061e-01,
K_8_24*2.454123e-02,
K_8_24*9.091680e-01,
K_8_24*-7.409511e-01,
K_8_24*-3.253103e-01,
K_8_24*9.972905e-01,
K_8_24*-4.605387e-01,
K_8_24*-6.343933e-01,
K_8_24*9.604305e-01,
K_8_24*-1.224107e-01,
K_8_24*-8.639729e-01,
K_8_24*8.032075e-01,
K_8_24*2.310581e-01,
K_8_24*-9.852776e-01,
K_8_24*5.453250e-01,
K_8_24*5.555702e-01,
K_8_24*-9.831055e-01,
K_8_24*2.191012e-01,
K_8_24*8.104572e-01,
K_8_24*-8.577286e-01,
K_8_24*-1.345807e-01,
K_8_24*9.637761e-01,
K_8_24*-6.248595e-01,
K_8_24*-4.713967e-01,
K_8_24*9.963126e-01,
K_8_24*-3.136817e-01,
K_8_24*-7.491364e-01,
K_8_24*9.039893e-01,
K_8_24*3.680722e-02,
K_8_24*-9.329928e-01,
K_8_24*6.983762e-01,
K_8_24*3.826834e-01,
K_8_24*-9.999247e-01,
K_8_24*4.052413e-01,
K_8_24*6.806010e-01,
K_8_24*-9.415441e-01,
K_8_24*6.132074e-02,
K_8_24*8.932243e-01,
K_8_24*-7.651673e-01,
K_8_24*-2.902847e-01,
K_8_24*9.939070e-01,
K_8_24*-4.928982e-01,
K_8_24*-6.055110e-01,
K_8_24*9.700313e-01,
K_8_24*-1.588581e-01,
K_8_24*-8.448536e-01,
K_8_24*8.245893e-01,
K_8_24*1.950903e-01,
K_8_24*-9.783174e-01,
K_8_24*5.758082e-01,
K_8_24*5.245897e-01,
K_8_24*-9.891765e-01,
K_8_24*2.548657e-01,
K_8_24*7.883464e-01,
K_8_24*-8.760701e-01,
K_8_24*-9.801714e-02,
K_8_24*9.533060e-01,
K_8_24*-6.531728e-01,
K_8_24*-4.386162e-01,
K_8_24*9.987955e-01,
K_8_24*-3.484187e-01,
K_8_24*-7.242471e-01,
K_8_24*9.191139e-01,
K_8_24*3.037495e-14,
};

s32 output_filter (const s32 *coeff, const s32 *signal)
{
	s32 result=0;
	int i=0;
		
	for (i=0;i<256;i++) 
	{
		result = result + coeff[i]*signal[i];
	}
	
	return result;
}

void test_Filter(void)
{
	s32 output_result1 = 0;
	s32 output_result2 = 0;
	s32 output_result3 = 0;
	s32 output_result4 = 0;
	s32 a = 0 ;
	int i = 0;
	
	s_serialComm_setErrorLED(LED_ON);
	output_result1 = output_filter (test_filter_coeff, test_signal1);
	s_serialComm_setErrorLED(LED_OFF);
	
	output_result2 = output_filter (test_signal1, test_signal2);
	
	s_serialComm_setErrorLED(LED_ON);
	output_result3 = output_filter (test_filter_coeff, test_signal2);
	s_serialComm_setErrorLED(LED_OFF);
	
	output_result4 = output_filter (test_signal2, test_signal1);
	
	//output_result4 = output_filter (test_filter_coeff, test_signal);
	
	if (output_result1 > a || output_result2 > a || output_result3 > a || output_result4 > a)
	{
		s_serialComm_setErrorLED(LED_ON);
	}
	
	
	/*
	output_result = output_filter (h_0, test_signal);
	output_result = output_filter (h_0, test_signal);
	output_result = output_filter (h_0, test_signal);
	output_result = output_filter (h_0, test_signal);
		*/
}


int main (void)
{	
	// Initialization
	app_initialization();

	
	
	// Infinity loop 
	while(1)
	{
		test_Filter();
	}
		
	return 0;
}
